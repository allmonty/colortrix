# ColorTrix Architecture

## Application Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        User Interface                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: Upload Image                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚  â”‚  [Upload]  â”‚ â”€â”€â–º ImagePicker.pickImage()                  â”‚
â”‚  â”‚   Button   â”‚                                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                                        â”‚
â”‚                     â–¼                                        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚              â”‚ File.readAs  â”‚                                â”‚
â”‚              â”‚   Bytes()    â”‚                                â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                     â”‚                                        â”‚
â”‚                     â–¼                                        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚              â”‚ img.decode   â”‚                                â”‚
â”‚              â”‚   Image()    â”‚                                â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                     â”‚                                        â”‚
â”‚                     â–¼                                        â”‚
â”‚              _originalImage (stored)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: Display Image & Matrix Editor                       â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  Original Image  â”‚    â”‚  3x3 Matrix Input  â”‚             â”‚
â”‚  â”‚    (Preview)     â”‚    â”‚  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”     â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚Râ†“Râ”‚Râ†“Gâ”‚Râ†“Bâ”‚     â”‚             â”‚
â”‚                          â”‚  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤     â”‚             â”‚
â”‚                          â”‚  â”‚Gâ†“Râ”‚Gâ†“Gâ”‚Gâ†“Bâ”‚     â”‚             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤     â”‚             â”‚
â”‚  â”‚ Preset Buttons:  â”‚    â”‚  â”‚Bâ†“Râ”‚Bâ†“Gâ”‚Bâ†“Bâ”‚     â”‚             â”‚
â”‚  â”‚ [Identity]       â”‚    â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜     â”‚             â”‚
â”‚  â”‚ [Grayscale]      â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚  â”‚ [Sepia]          â”‚                                        â”‚
â”‚  â”‚ [Invert]         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ [Swap R/B]       â”‚    â”‚  Color Preview     â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  Before â†’ After    â”‚             â”‚
â”‚                          â”‚  ğŸŸ¥ â”€â”€â–º ğŸŸ¥         â”‚             â”‚
â”‚                          â”‚  ğŸŸ© â”€â”€â–º ğŸŸ©         â”‚             â”‚
â”‚                          â”‚  ğŸŸ¦ â”€â”€â–º ğŸŸ¦         â”‚             â”‚
â”‚                          â”‚  ... (8 colors)    â”‚             â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: Process Image                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚  â”‚ [Process]  â”‚ â”€â”€â–º _processImage()                          â”‚
â”‚  â”‚   Button   â”‚                                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                                        â”‚
â”‚                     â–¼                                        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚              â”‚ _getMatrix()     â”‚                            â”‚
â”‚              â”‚ Extract values   â”‚                            â”‚
â”‚              â”‚ from UI inputs   â”‚                            â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                       â”‚                                      â”‚
â”‚                       â–¼                                      â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚              â”‚ compute()                â”‚  â† Background      â”‚
â”‚              â”‚ Run in separate isolate  â”‚    Isolate         â”‚
â”‚              â”‚ _applyMatrixTransform()  â”‚                    â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                       â”‚                                      â”‚
â”‚              For each pixel (x, y):                          â”‚
â”‚                       â”‚                                      â”‚
â”‚                       â–¼                                      â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚         â”‚ Get RGB (normalize 0-1)      â”‚                     â”‚
â”‚         â”‚ r = pixel.r / 255.0          â”‚                     â”‚
â”‚         â”‚ g = pixel.g / 255.0          â”‚                     â”‚
â”‚         â”‚ b = pixel.b / 255.0          â”‚                     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                    â”‚                                         â”‚
â”‚                    â–¼                                         â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚         â”‚ Apply Matrix Transform:      â”‚                     â”‚
â”‚         â”‚                              â”‚                     â”‚
â”‚         â”‚ R' = Mâ‚€â‚€Â·R + Mâ‚€â‚Â·G + Mâ‚€â‚‚Â·B  â”‚                     â”‚
â”‚         â”‚ G' = Mâ‚â‚€Â·R + Mâ‚â‚Â·G + Mâ‚â‚‚Â·B  â”‚                     â”‚
â”‚         â”‚ B' = Mâ‚‚â‚€Â·R + Mâ‚‚â‚Â·G + Mâ‚‚â‚‚Â·B  â”‚                     â”‚
â”‚         â”‚                              â”‚                     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                    â”‚                                         â”‚
â”‚                    â–¼                                         â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚         â”‚ Clamp to [0.0, 1.0] range    â”‚                     â”‚
â”‚         â”‚ Convert back to [0, 255]     â”‚                     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                    â”‚                                         â”‚
â”‚                    â–¼                                         â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚         â”‚ Set pixel in output image    â”‚                     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                       â”‚                                      â”‚
â”‚                       â–¼                                      â”‚
â”‚              _processedImage (stored)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4: Display & Save Result                               â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚ Processed Image  â”‚                                        â”‚
â”‚  â”‚   (Preview)      â”‚                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚  â”‚   [Save]   â”‚ â”€â”€â–º _saveImage()                             â”‚
â”‚  â”‚   Button   â”‚                                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                                        â”‚
â”‚                     â–¼                                        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚              â”‚ img.encode   â”‚                                â”‚
â”‚              â”‚   Png()      â”‚                                â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                     â”‚                                        â”‚
â”‚                     â–¼                                        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚              â”‚ getApplication    â”‚                           â”‚
â”‚              â”‚ DocumentsDirectoryâ”‚                           â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                     â”‚                                        â”‚
â”‚                     â–¼                                        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚              â”‚ File.write   â”‚                                â”‚
â”‚              â”‚  AsBytes()   â”‚                                â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                     â”‚                                        â”‚
â”‚                     â–¼                                        â”‚
â”‚              [Success Dialog]                                â”‚
â”‚            "Image saved to: /path"                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       MyApp                          â”‚
â”‚                  (StatelessWidget)                   â”‚
â”‚                                                      â”‚
â”‚  â€¢ Configures MaterialApp                           â”‚
â”‚  â€¢ Sets up theme                                    â”‚
â”‚  â€¢ Defines home page                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ColorTrixPage                       â”‚
â”‚                 (StatefulWidget)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              _ColorTrixPageState                     â”‚
â”‚                    (State)                           â”‚
â”‚                                                      â”‚
â”‚  State Variables:                                   â”‚
â”‚  â€¢ _imageFile: File?                                â”‚
â”‚  â€¢ _originalImage: img.Image?                       â”‚
â”‚  â€¢ _processedImage: img.Image?                      â”‚
â”‚  â€¢ _picker: ImagePicker                             â”‚
â”‚  â€¢ _isProcessing: bool                              â”‚
â”‚  â€¢ _matrixControllers: List<List<Controller>>       â”‚
â”‚                                                      â”‚
â”‚  Methods:                                           â”‚
â”‚  â”œâ”€ _pickImage()                                    â”‚
â”‚  â”œâ”€ _getMatrix()                                    â”‚
â”‚  â”œâ”€ _processImage()                                 â”‚
â”‚  â”œâ”€ _saveImage()                                    â”‚
â”‚  â”œâ”€ _setMatrixPreset()                              â”‚
â”‚  â”œâ”€ _applyMatrixToColor()                           â”‚
â”‚  â”œâ”€ _buildColorPreview()                            â”‚
â”‚  â”œâ”€ _buildMatrixInput()                             â”‚
â”‚  â””â”€ build()                                         â”‚
â”‚                                                      â”‚
â”‚  Static Methods:                                    â”‚
â”‚  â””â”€ _applyMatrixTransformation() [Isolate]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow

```
User Action          State Change           UI Update
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[Upload]     â”€â”€â–º    _imageFile = file  â”€â”€â–º Display image
                    _originalImage = img    Show matrix

[Edit Matrix]â”€â”€â–º    Controllers update â”€â”€â–º Preview colors
                                            update

[Preset]     â”€â”€â–º    Controllers set    â”€â”€â–º Matrix & preview
                    to preset values        update

[Process]    â”€â”€â–º    _isProcessing=true â”€â”€â–º Show spinner
                         â”‚
                         â–¼
                    [Background]
                    Transform pixels
                         â”‚
                         â–¼
                    _processedImage=result â–º Hide spinner
                    _isProcessing=false     Display result

[Save]       â”€â”€â–º    Write to file      â”€â”€â–º Show dialog
```

## Matrix Transformation Mathematics

```
Color Space: RGB, normalized to [0.0, 1.0]

Input Vector:    â”Œ   â”
                 â”‚ R â”‚
        V_in  =  â”‚ G â”‚
                 â”‚ B â”‚
                 â””   â”˜

Transform Matrix:  â”Œ               â”
                   â”‚ Mâ‚€â‚€  Mâ‚€â‚  Mâ‚€â‚‚ â”‚
              M =  â”‚ Mâ‚â‚€  Mâ‚â‚  Mâ‚â‚‚ â”‚
                   â”‚ Mâ‚‚â‚€  Mâ‚‚â‚  Mâ‚‚â‚‚ â”‚
                   â””               â”˜

Output Vector:   â”Œ    â”       â”Œ   â”
                 â”‚ R' â”‚       â”‚ R â”‚
       V_out  =  â”‚ G' â”‚ = M Ã— â”‚ G â”‚
                 â”‚ B' â”‚       â”‚ B â”‚
                 â””    â”˜       â””   â”˜

Expanded form:
    R' = Mâ‚€â‚€Â·R + Mâ‚€â‚Â·G + Mâ‚€â‚‚Â·B
    G' = Mâ‚â‚€Â·R + Mâ‚â‚Â·G + Mâ‚â‚‚Â·B  
    B' = Mâ‚‚â‚€Â·R + Mâ‚‚â‚Â·G + Mâ‚‚â‚‚Â·B

Post-processing:
    R', G', B' are clamped to [0.0, 1.0]
    Then scaled to [0, 255] for display
```

## Threading Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Main Isolate  â”‚  (UI Thread)
â”‚   (UI Thread)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1. User clicks "Process"
         â”‚
         â”œâ”€â–º Set _isProcessing = true
         â”‚   Update UI (show spinner)
         â”‚
         â”‚ 2. Call compute()
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                             â”‚
         â”‚                             â–¼
         â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                   â”‚ Worker Isolate   â”‚
         â”‚                   â”‚                  â”‚
         â”‚                   â”‚ _applyMatrix     â”‚
         â”‚                   â”‚ Transformation() â”‚
         â”‚                   â”‚                  â”‚
         â”‚                   â”‚ â€¢ For each pixel â”‚
         â”‚                   â”‚ â€¢ Apply matrix   â”‚
         â”‚                   â”‚ â€¢ Set new color  â”‚
         â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                            â”‚
         â”‚ 3. Wait for result         â”‚
         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 4. Receive processed image
         â”‚
         â”œâ”€â–º Set _processedImage = result
         â”‚   Set _isProcessing = false
         â”‚   Update UI (hide spinner, show result)
         â”‚
         â–¼
```

## Platform Support Matrix

```
Feature              Android    iOS    Web
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Image Upload           âœ“         âœ“      âœ“
Image Display          âœ“         âœ“      âœ“
Matrix Input           âœ“         âœ“      âœ“
Color Preview          âœ“         âœ“      âœ“
Image Processing       âœ“         âœ“      âœ“
Save to Device         âœ“         âœ“      âœ“*

* Web saves to browser's download folder
```

## Dependencies Graph

```
colortrix
â”œâ”€â”€ flutter (SDK)
â”‚   â””â”€â”€ dart (SDK)
â”œâ”€â”€ image_picker: ^1.0.4
â”‚   â”œâ”€â”€ Platform-specific implementations
â”‚   â”‚   â”œâ”€â”€ Android: Gallery/Camera access
â”‚   â”‚   â”œâ”€â”€ iOS: Photos framework
â”‚   â”‚   â””â”€â”€ Web: File input element
â”œâ”€â”€ image: ^4.1.3
â”‚   â”œâ”€â”€ Image encoding (PNG, JPEG)
â”‚   â”œâ”€â”€ Image decoding
â”‚   â””â”€â”€ Pixel manipulation
â”œâ”€â”€ path_provider: ^2.1.1
â”‚   â”œâ”€â”€ Platform-specific directories
â”‚   â”‚   â”œâ”€â”€ Android: getApplicationDocumentsDirectory
â”‚   â”‚   â”œâ”€â”€ iOS: getApplicationDocumentsDirectory
â”‚   â”‚   â””â”€â”€ Web: Downloads directory
â””â”€â”€ cupertino_icons: ^1.0.2
    â””â”€â”€ iOS-style icons
```

## File Structure

```
colortrix/
â”‚
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ main.dart              (Single file implementation)
â”‚       â”œâ”€â”€ main()             (Entry point)
â”‚       â”œâ”€â”€ MyApp              (Root widget)
â”‚       â””â”€â”€ ColorTrixPage      (Main functionality)
â”‚           â””â”€â”€ _ColorTrixPageState
â”‚               â”œâ”€â”€ State variables
â”‚               â”œâ”€â”€ Lifecycle methods
â”‚               â”œâ”€â”€ Business logic
â”‚               â””â”€â”€ UI builders
â”‚
â”œâ”€â”€ android/                   (Android platform)
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ build.gradle      (App configuration)
â”‚   â”‚   â””â”€â”€ src/main/
â”‚   â”‚       â”œâ”€â”€ AndroidManifest.xml (Permissions)
â”‚   â”‚       â””â”€â”€ kotlin/...MainActivity.kt
â”‚   â”œâ”€â”€ build.gradle          (Project config)
â”‚   â””â”€â”€ settings.gradle       (Module config)
â”‚
â”œâ”€â”€ ios/                      (iOS platform)
â”‚   â””â”€â”€ Runner/
â”‚       â”œâ”€â”€ AppDelegate.swift (App delegate)
â”‚       â””â”€â”€ Info.plist        (Permissions)
â”‚
â”œâ”€â”€ web/                      (Web platform)
â”‚   â”œâ”€â”€ index.html           (Entry HTML)
â”‚   â””â”€â”€ manifest.json        (PWA manifest)
â”‚
â”œâ”€â”€ test/
â”‚   â””â”€â”€ widget_test.dart     (Unit tests)
â”‚
â”œâ”€â”€ pubspec.yaml             (Dependencies)
â”œâ”€â”€ analysis_options.yaml    (Linting)
â”œâ”€â”€ README.md               (Overview)
â”œâ”€â”€ DEVELOPMENT.md          (Technical docs)
â””â”€â”€ USER_GUIDE.md          (User manual)
```
